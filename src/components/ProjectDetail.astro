---
import SketchContainer from './sketches/SketchContainer.astro';

interface Badge {
  src: string;
  alt: string;
  href?: string;
}

interface Props {
  title: string;
  tagline: string;
  tags: string[];
  repo?: string;
  liveUrl?: string;
  badges?: Badge[];
  heroImage?: { src: string; alt: string };
}

const base = import.meta.env.BASE_URL.replace(/\/?$/, '/');
const { title, tagline, tags, repo, liveUrl, badges, heroImage } = Astro.props;
---

<article class="project">
  <header class="project__header">
    <a href={base} class="project__back">&larr; All projects</a>
    <div class="project__tags">
      {tags.map(tag => <span class="tag">{tag}</span>)}
    </div>
    <h1 class="project__title">{title}</h1>
    <p class="project__tagline">{tagline}</p>
    {badges && badges.length > 0 && (
      <div class="project__badges">
        {badges.map(b => b.href
          ? <a href={b.href} target="_blank" rel="noopener"><img src={b.src} alt={b.alt} loading="lazy" /></a>
          : <img src={b.src} alt={b.alt} loading="lazy" />
        )}
      </div>
    )}
    {(repo || liveUrl) && (
      <div class="project__links">
        {repo && <a href={repo} target="_blank" rel="noopener noreferrer" class="project__link">GitHub &rarr;</a>}
        {liveUrl && <a href={liveUrl} target="_blank" rel="noopener noreferrer" class="project__link">Live &rarr;</a>}
      </div>
    )}
  </header>
  {heroImage && (
    <img class="project__hero-image" src={heroImage.src} alt={heroImage.alt} loading="lazy" />
  )}
  <div class="sketch-accent">
    <SketchContainer sketchId="recursive-tree" height="250px" mobileHeight="180px" ariaLabel="Animated recursive tree visualization representing project structure" data-tags={tags.join(',')} />
  </div>
  <div class="project__body prose">
    <slot />
  </div>
</article>

<style>
  .project {
    max-width: var(--max-width-narrow);
    margin: 0 auto;
    padding: var(--space-3xl) var(--space-lg);
  }

  .project__header {
    margin-bottom: var(--space-3xl);
  }

  .project__back {
    display: inline-block;
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: var(--space-xl);
    transition: color var(--transition-fast);
  }

  .project__back:hover {
    color: var(--text-primary);
  }

  .project__tags {
    display: flex;
    gap: var(--space-xs);
    margin-bottom: var(--space-md);
  }

  .project__title {
    margin-bottom: var(--space-sm);
  }

  .project__tagline {
    font-size: 1.15rem;
    color: var(--accent);
    font-style: italic;
    max-width: 55ch;
  }

  .project__badges {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-top: var(--space-lg);
  }

  .project__badges img {
    height: 20px;
    border-radius: 3px;
  }

  .project__hero-image {
    width: 100%;
    border-radius: 8px;
    border: 1px solid var(--border);
    margin-bottom: var(--space-xl);
  }

  .project__links {
    display: flex;
    gap: var(--space-lg);
    margin-top: var(--space-lg);
  }

  .project__link {
    font-size: 0.9rem;
    color: var(--text-secondary);
    border: 1px solid var(--border);
    padding: var(--space-sm) var(--space-md);
    border-radius: 6px;
    transition: all var(--transition-fast);
  }

  .project__link:hover {
    color: var(--accent);
    border-color: var(--accent);
  }

  .project__body {
    line-height: 1.8;
  }
  .sketch-accent {
    margin-bottom: var(--space-xl);
  }

  @media (max-width: 768px) {
    .project {
      padding: var(--space-2xl) var(--space-md);
    }
  }
</style>
