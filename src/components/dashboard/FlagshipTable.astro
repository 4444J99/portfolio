---
import ChartContainer from '../charts/ChartContainer.astro';
import type { FlagshipRepo } from '../../types/data';

interface Props {
  repos: FlagshipRepo[];
  classifications: Record<string, number>;
  totalAudited: number;
  classificationChartData: Record<string, unknown>;
  flagshipChartData: Record<string, unknown>;
}

const { repos, classifications, totalAudited, classificationChartData, flagshipChartData } = Astro.props;
---

<section class="section">
  <div class="container">
    <h2 class="section__heading">Flagship Analysis</h2>
    <div class="chart-pair">
      <ChartContainer chartId="classification-donut" data={classificationChartData} ariaLabel="Donut chart showing flagship classification breakdown" height="280px" />
      <ChartContainer chartId="flagship-stacked" data={flagshipChartData} ariaLabel="Stacked bar chart showing code vs test files per flagship" height="280px" />
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="section__heading">Flagship Vivification</h2>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Repository</th>
            <th>Org</th>
            <th>Classification</th>
            <th>Code Files</th>
            <th>Tests</th>
          </tr>
        </thead>
        <tbody>
          {repos.map((repo: FlagshipRepo) => (
            <tr>
              <td>
                <a href={`https://github.com/${repo.org}/${repo.repo}`} target="_blank" rel="noopener noreferrer">
                  {repo.repo}
                </a>
              </td>
              <td>{repo.org}</td>
              <td>
                <span class={`tag tag--${repo.classification.toLowerCase()}`}>
                  {repo.classification}
                </span>
              </td>
              <td>{repo.code_files}</td>
              <td>{repo.test_files}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
    <p class="table-summary">
      {classifications.SUBSTANTIAL} SUBSTANTIAL,
      {classifications.PARTIAL} PARTIAL,
      {classifications.MINIMAL} MINIMAL
      â€” {totalAudited} flagships audited
    </p>
  </div>
</section>

<style>
  .chart-pair {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-lg);
  }

  .table-summary {
    margin-top: var(--space-md);
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  .tag--substantial { background: rgba(124, 232, 166, 0.15); color: var(--color-substantial); }
  .tag--partial { background: rgba(201, 168, 76, 0.15); color: var(--color-partial); }
  .tag--minimal { background: rgba(232, 124, 124, 0.15); color: var(--color-minimal); }

  @media (max-width: 768px) {
    .chart-pair {
      grid-template-columns: 1fr;
    }
  }
</style>
