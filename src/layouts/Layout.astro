---
import { ViewTransitions } from 'astro:transitions';
import BackToTop from '../components/BackToTop.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import BaseMeta from '../components/head/BaseMeta.astro';
import FaviconLinks from '../components/head/FaviconLinks.astro';
import SiteLinks from '../components/head/SiteLinks.astro';
import SEOMeta from '../components/head/SEOMeta.astro';
import SchemaOrg from '../components/head/SchemaOrg.astro';
import FontFaces from '../components/head/FontFaces.astro';
import SketchLifecycle from '../components/scripts/SketchLifecycle.astro';
import ScrollReveal from '../components/scripts/ScrollReveal.astro';
import ClientBootstrap from '../components/scripts/ClientBootstrap.astro';
import ThemeRestore from '../components/scripts/ThemeRestore.astro';
import { canonicalBase } from '../utils/paths';

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  mainClass?: string;
  mainAttrs?: Record<string, string>;
}

const slug = Astro.url.pathname.replace(/^\/portfolio\//, '').replace(/\/$/, '') || 'index';
const defaultOG = `${canonicalBase}/og/${slug}.png`;
const {
  title,
  description = "Creative technologist building autonomous creative systems and treating governance as artistic medium.",
  ogImage = defaultOG,
  mainClass,
  mainAttrs = {},
} = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, 'https://4444j99.github.io').href;
---

<!doctype html>
<html lang="en">
  <head>
    <BaseMeta description={description} canonicalURL={canonicalURL} />
    <FaviconLinks />
    <SiteLinks />
    <SEOMeta title={title} description={description} canonicalURL={canonicalURL} ogImage={ogImage} />
    <SchemaOrg description={description} ogImage={ogImage} />
    <FontFaces />
    <ViewTransitions />
    <title>{title}</title>
  </head>
  <body data-bg-mode="subtle">
    <a href="#main-content" class="skip-to-content">Skip to main content</a>
    <div id="bg-canvas" aria-hidden="true" transition:persist></div>
    <Header />
    <main id="main-content" class:list={[mainClass]} {...mainAttrs}>
      <slot />
    </main>
    <Footer />
    <BackToTop />
  </body>
  <SketchLifecycle />
  <ScrollReveal />
  <ClientBootstrap />
  <ThemeRestore />
</html>

<style is:global>
  @import '../styles/global.css';
</style>
