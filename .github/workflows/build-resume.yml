name: Build Resume PDF

on:
  push:
    paths:
      - 'resume/Anthony_James_Padavano_CV.yaml'
      - 'resume/Anthony_James_Padavano_Multimedia.yaml'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install RenderCV
        run: pip install "rendercv[full]"

      - name: Render Creative Technologist resume
        run: rendercv render resume/Anthony_James_Padavano_CV.yaml --output-folder-name resume/rendercv_output

      - name: Render Multimedia Specialist resume
        run: rendercv render resume/Anthony_James_Padavano_Multimedia.yaml --output-folder-name resume/rendercv_output_multimedia

      - name: Install pandoc
        run: sudo apt-get install -y pandoc

      - name: Generate DOCX from Creative Technologist Markdown
        run: |
          pandoc resume/rendercv_output/Anthony_James_Padavano_CV.md \
            -o resume/rendercv_output/Anthony_James_Padavano_CV.docx

      - name: Copy outputs to public for Astro deployment
        run: |
          mkdir -p public/resume
          cp resume/rendercv_output/Anthony_James_Padavano_CV.pdf public/resume/Anthony_James_Padavano_CV.pdf
          cp resume/rendercv_output_multimedia/Anthony_James_Padavano_Multimedia.pdf public/resume/Anthony_James_Padavano_Multimedia.pdf
          cp resume/rendercv_output/Anthony_James_Padavano_CV.docx public/resume/Anthony_James_Padavano_CV.docx

      - name: Create GitHub Release with PDFs
        uses: softprops/action-gh-release@v2
        with:
          tag_name: resume-${{ github.sha }}
          name: Resume â€” ${{ github.event.head_commit.timestamp }}
          files: |
            resume/rendercv_output/Anthony_James_Padavano_CV.pdf
            resume/rendercv_output_multimedia/Anthony_James_Padavano_Multimedia.pdf
            resume/rendercv_output/Anthony_James_Padavano_CV.docx
          body: |
            Auto-generated resume PDFs from RenderCV YAML sources.

            - [Creative Technologist PDF](https://github.com/4444J99/portfolio/releases/latest/download/Anthony_James_Padavano_CV.pdf)
            - [Multimedia Specialist PDF](https://github.com/4444J99/portfolio/releases/latest/download/Anthony_James_Padavano_Multimedia.pdf)

      - name: Commit PDFs to public/ for site deployment
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add -f public/resume/Anthony_James_Padavano_CV.pdf public/resume/Anthony_James_Padavano_Multimedia.pdf public/resume/Anthony_James_Padavano_CV.docx
          git diff --cached --quiet || git commit -m "chore: update rendered resume PDFs [skip ci]"
          git push
